# RayGate

RayGate — это оснастка VPN для маршрутизаторов с Entware/OpenWRT, использующая протокол VLESS с помощью библиотеки xray-core.
Пакет позволяет настраивать whitelist доменов, которые будут маршрутизироваться через VPN, при этом остальной трафик идет напрямую, тем самым исключая необходимость постоянного включения/отключения VPN при необходимости зайти на нужные ресурсы.

Управление программой осуществляется через встроенный веб-интерфейс.

_Проект тестировался на роутере Keenetic Peak (aarch64), но может работать на любых устройствах и архитектурах, поддерживающих Entware/OpenWRT._

>Подробнее как установить OPKG на роутеры Keenetic [здесь](https://help.keenetic.com/hc/ru/articles/360000948719-OPKG).

### Реализованные фичи

* Перехват и проксирование трафика выбранных доменов через VLESS (Xray-core)

* Добавление/удаление доменов через веб-панель

* Автоматическая подгрузка новых правил в dnsmasq и ipset

* Упрощенная установка через opkg

### Установка

1. Добавьте репозиторий RayGate в opkg:

```
mkdir -p /opt/etc/opkg
echo "src/gz raygate https://raw.githubusercontent.com/DM-TRIY/RayGate/gh-pages/all/" > /opt/etc/opkg/raygate.conf
```

2. Обновите списки пакетов:

``` 
opkg update 
```

3. Установите RayGate:

``` 
opkg install raygate 
```

4. Следуйте инструкциям при установке:

    * Укажите ссылку vless://…, полученную от своего VPN-провайдера - RayGate автоматически подстроится под неё

    * Задайте логин и пароль для входа в веб‑панель

    * Скрипт автоматически настроит dnsmasq, запустит службу и создаст веб‑панель на порту 9090

### Обновление

``` 
opkg update && opkg upgrade raygate
```

### Удаление

``` 
opkg remove raygate
```

Программа сама в автоматическом режиме остановит сервисы, очистит кэш opkg и удалит временные файлы

### CLI команды

* Добавить домен, чтобы начать его проксировать:
``` 
/opt/bin/raygate/raygate_add.sh example.com
``` 

* Удалить домен полностью (из dnsmasq и ipset):
``` 
/opt/bin/raygate/raygate_remove.sh example.com
``` 


* Проверить текущий список доменов:
``` 
cat /opt/etc/dnsmasq.d/90-vpn-domains.conf
``` 

* Проверить текущий список IP в ipset:
``` 
ipset list vpn_domains
``` 
