#!/bin/sh
set -e

echo "[RayGate] Running post-install auto-setup..."


echo "[RayGate] Creating dir's..."

mkdir -p /opt/etc/dnsmasq.d
mkdir -p /opt/etc/xray
mkdir -p /opt/var/log/xray

echo "[RayGate] Dir's created!"

echo "[RayGate] Installing python libs..."

pip3 install --no-cache-dir flask bcrypt >/dev/null 2>&1 || true

echo "[RayGate] Python libs installed!"

echo "[RayGate] Setting permissions..."

chmod +x /opt/etc/init.d/S99raygate 2>/dev/null || true
chmod +x /opt/bin/raygate/raygate_add.sh 2>/dev/null || true
chmod +x /opt/bin/raygate/rayweb/rayweb.py 2>/dev/null || true
chmod +x /opt/bin/raygate/raygate_configure.sh 2>/dev/null || true

echo "[RayGate] Permissions set!"

echo "[RayGate] Done!"
echo "[RayGate] Для завершения настройки и конфигурации RayGate под ваше устройство выполните:"
echo "sh  /opt/bin/raygate/raygate_configure.sh"
